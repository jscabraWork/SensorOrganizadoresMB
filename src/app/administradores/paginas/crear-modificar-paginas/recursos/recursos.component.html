<section class="recursos">

  <!-- Header -->
  <div class="recursos-header">
    <h3>Recursos</h3>
    <button class="btn-toggle" (click)="toggleFormularioCreacion()">
      {{ mostrarFormularioCreacion ? 'Cancelar' : 'Nuevo recurso' }}
    </button>
  </div>

  <!-- Formulario de creación -->
  <div class="recursos-crear" *ngIf="mostrarFormularioCreacion">
    <app-crear-recursos 
    [paginaId]="id" [tipoRecurso]="tiposPermitidos.length === 1 ? tiposPermitidos[0] : -1"
      (recursoCreado)="onRecursoCreado($event)">
    </app-crear-recursos>
  </div>

  <!-- Sin resultados -->
  <div class="empty" *ngIf="!cargando && (!lista || lista.length === 0)">
    <p>No hay recursos disponibles</p>
  </div>

  <!-- Grid de recursos -->
  <div class="recursos-grid" *ngIf="!cargando && lista && lista.length > 0">
    <div class="recurso-card" *ngFor="let recurso of lista" (click)="seleccionarRecurso(recurso)">

      <!-- Botón eliminar -->
    <button class="btn-delete" (click)="deleteById(recurso, $event)" title="Eliminar recurso">
      ×
    </button>

      <!-- Preview -->
      <div class="recurso-preview">
        <img *ngIf="recurso.tipo === 0" [src]="recurso.url" [alt]="recurso.nombre">
        <div *ngIf="recurso.tipo === 1" class="video-preview">
          <!-- Videos directos -->
          <video *ngIf="esVideoDirecto(recurso.url)" [src]="recurso.url" preload="metadata">
          </video>
          <!-- Videos de plataformas (YouTube, Vimeo, etc) -->
          <iframe *ngIf="!esVideoDirecto(recurso.url)" [src]="getSafeUrl(recurso.url)" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
          </iframe>
        </div>
      </div>

      <!-- Info -->
      <div class="recurso-info">
        <h4 class="recurso-nombre">{{ recurso.nombre }}</h4>
        <div class="recurso-meta">
          <span class="tipo">{{ recurso.tipo === 0 ? 'Imagen' : 'Video' }}</span>
          <span class="size">{{ formatearTamano(recurso.size) }}</span>
        </div>
      </div>
    </div>
  </div>
</section>