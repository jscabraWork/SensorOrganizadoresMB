<div class="detalle-container">

  <!-- Content -->
  <div *ngIf="!error" class="content-container">
    
    <!-- Título -->
    <app-titulo titulo="INFORMACIÓN DETALLADA"></app-titulo>
    
    <!-- Filtro Simple -->
    <div class="filtro-simple">
      <select 
        class="form-select"
        [(ngModel)]="localidadIdSeleccionada"
        (change)="actualizarFiltros(localidadIdSeleccionada)">
        <option [value]="-1">Todas las localidades</option>
        <option *ngFor="let localidad of opcionesLocalidades" [value]="localidad.value">
          {{ localidad.label }}
        </option>
      </select>
    </div>

    <!-- Tabla de Detalle -->
    <app-tabla-organizadores
      [datos]="detalle"
      [columnas]="columnasTabla"
      [expandible]="true"
      [datosExpandidos]="obtenerDatosExpandidos"
      [cargando]="cargando"
      [sinDatosMensaje]="'No hay datos disponibles para los filtros seleccionados'"
      [titulo]="'Detalle de Ventas'"
      [mostrarPieTabla]="detalle.length > 0"
      [pieTabla]="totalesTabla"
      (filaExpandida)="onFilaExpandida($event)">
    </app-tabla-organizadores>

    <!-- Resumen con Submenu -->
    <div *ngIf="resumen" class="resumen-container">
      
      <!-- Submenu -->
      <div class="resumen-submenu">
        <button 
          class="submenu-btn" 
          [class.active]="vistaResumen === 'financiero'"
          (click)="vistaResumen = 'financiero'">
          Resumen Financiero
        </button>
        <button 
          class="submenu-btn" 
          [class.active]="vistaResumen === 'asistentes'"
          (click)="vistaResumen = 'asistentes'">
          Resumen Asistentes
        </button>
      </div>

      <!-- Resumen Financiero -->
      <div *ngIf="vistaResumen === 'financiero'" class="resumen-content">
        <div class="pills-container">
          
          <div class="pill-card">
            <div class="pill-title">Recaudado</div>
            <div class="pill-value">{{ resumen.totalRecaudado | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>

          <div class="pill-card">
            <div class="pill-title">Servicio Recaudado</div>
            <div class="pill-value">{{ resumen.servicioRecaudado | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>

          <div class="pill-card">
            <div class="pill-title">Iva Recaudado</div>
            <div class="pill-value">{{ resumen.ivaRecaudado | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="pill-card">
            <div class="pill-title">Transacciones</div>
            <div class="pill-value">{{ resumen.totalTransacciones | number }}</div>
          </div>
          
          <div class="pill-card">
            <div class="pill-title">Promedio Venta</div>
            <div class="pill-value">{{ (resumen.totalRecaudado / resumen.totalTransacciones) | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="pill-card negative">
            <div class="pill-title">Comisiones</div>
            <div class="pill-value">-{{ resumen.totalComisiones | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="pill-card negative">
            <div class="pill-title">Retenciones</div>
            <div class="pill-value">-{{ resumen.totalRetenciones | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>
        
          <div class="pill-card highlight">
            <div class="pill-title">Ganancia Neta</div>
            <div class="pill-value">{{ (resumen.totalRecaudado - resumen.totalComisiones - resumen.totalRetenciones) | currency:'COP':'symbol':'1.0-0' }}</div>
          </div>
          
        </div>
      </div>

      <!-- Resumen Asistentes -->
      <div *ngIf="vistaResumen === 'asistentes'" class="resumen-content">
        <div class="pills-container">
          
          <div class="pill-card">
            <div class="pill-title">Compradores</div>
            <div class="pill-value">{{ resumen.totalCompradores | number }}</div>
          </div>
          
          <div class="pill-card">
            <div class="pill-title">Cortesías</div>
            <div class="pill-value">{{ resumen.totalCortesias | number }}</div>
          </div>
          
          <div class="pill-card">
            <div class="pill-title">Ingresados</div>
            <div class="pill-value">{{ resumen.ingresos | number }}</div>
          </div>
          
          <div class="pill-card">
            <div class="pill-title">Porcentaje de Asistencia</div>
            <div class="pill-value">{{ (resumen.ingresos / resumen.asistentes * 100) | number:'1.1-1' }}%</div>
          </div>
          
          <div class="pill-card highlight">
            <div class="pill-title">Total Asistentes</div>
            <div class="pill-value">{{ resumen.asistentes | number }}</div>
          </div>
          
        </div>
      </div>

    </div>
  </div>

  <!-- Estado de error -->
  <app-error 
    *ngIf="error"
    [mensaje]="error"
    (reintentar)="cargarDatos()">
  </app-error>
</div>
