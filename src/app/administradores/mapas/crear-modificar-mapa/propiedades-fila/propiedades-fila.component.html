<div class="propiedades-panel">  <div class="panel-header">
    <h3>Propiedades de Fila</h3>
    <button type="button" class="btn-eliminar" (click)="eliminarFila()">
      <i class="fas fa-trash"></i>
    </button>
  </div>
  <!-- Selector de Estilo -->
  <div class="form-group">
    <label for="estilo">Estilo Predefinido:</label>
    <select 
      id="estilo" 
      [ngModel]="fila.estilo?.id || null"
      (ngModelChange)="onEstiloChange($event)"
      class="form-control">
      <option [ngValue]="null">-- Crear estilo personalizado --</option>      <option *ngFor="let estilo of estilosDisponibles" [ngValue]="estilo.id">
        Estilo {{estilo.id}} ({{estilo.backgroundColor || estilo.backgroundColor || '#default'}})
      </option>
    </select>
  </div>

  <div class="style-properties">
    <h4>Propiedades de Estilo (Para Asientos)</h4>
    
    <div class="form-row">
      <div class="form-group">
        <label for="ancho">Ancho (px):</label>
        <input 
          type="number" 
          id="ancho"
          [ngModel]="fila.estilo?.width || 200" 
          (ngModelChange)="updateStyleProperty('width', $event)"
          class="form-control"
          min="50"
          max="800"
          placeholder="200">
      </div>

      <div class="form-group">
        <label for="alto">Alto (px):</label>
        <input 
          type="number" 
          id="alto"
          [ngModel]="fila.estilo?.height || 40" 
          (ngModelChange)="updateStyleProperty('height', $event)"
          class="form-control"
          min="20"
          max="100"
          placeholder="40">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="colorFondo">Color de Fondo:</label>
        <div class="color-input-group">
          <input 
            type="color" 
            id="colorFondo"
            [ngModel]="fila.estilo?.backgroundColor || '#f8f9fa'" 
            (ngModelChange)="updateStyleProperty('backgroundColor', $event)"
            class="color-picker">
          <input 
            type="text" 
            [ngModel]="fila.estilo?.backgroundColor || '#f8f9fa'" 
            (ngModelChange)="updateStyleProperty('backgroundColor', $event)"
            class="form-control color-text"
            placeholder="#f8f9fa">
        </div>
      </div>

      <div class="form-group">
        <label for="borderColor">Color de Borde:</label>
        <div class="color-input-group">
          <input 
            type="color" 
            id="borderColor"
            [ngModel]="fila.estilo?.borderColor || '#dee2e6'" 
            (ngModelChange)="updateStyleProperty('borderColor', $event)"
            class="color-picker">
          <input 
            type="text" 
            [ngModel]="fila.estilo?.borderColor || '#dee2e6'" 
            (ngModelChange)="updateStyleProperty('borderColor', $event)"
            class="form-control color-text"
            placeholder="#dee2e6">
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="borderWidth">Grosor Borde (px):</label>
        <input 
          type="number" 
          id="borderWidth"
          [ngModel]="fila.estilo?.borderWidth || 1" 
          (ngModelChange)="updateStyleProperty('borderWidth', $event)"
          class="form-control"
          min="0"
          max="10"
          placeholder="1">
      </div>

      <div class="form-group">
        <label for="borderRadius">Border Radius (px):</label>
        <input 
          type="number" 
          id="borderRadius"
          [ngModel]="fila.estilo?.borderRadius || 4" 
          (ngModelChange)="updateStyleProperty('borderRadius', $event)"
          class="form-control"
          min="0"
          max="50"
          placeholder="4">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="color">Color de Texto:</label>
        <div class="color-input-group">
          <input 
            type="color" 
            id="color"
            [ngModel]="fila.estilo?.color || '#495057'" 
            (ngModelChange)="updateStyleProperty('color', $event)"
            class="color-picker">
          <input 
            type="text" 
            [ngModel]="fila.estilo?.color || '#495057'" 
            (ngModelChange)="updateStyleProperty('color', $event)"
            class="form-control color-text"
            placeholder="#495057">
        </div>
      </div>

      <div class="form-group">
        <label for="fontSize">Tamaño Fuente (px):</label>
        <input 
          type="number" 
          id="fontSize"
          [ngModel]="fila.estilo?.fontSize || 14" 
          (ngModelChange)="updateStyleProperty('fontSize', $event)"
          class="form-control"
          min="8"
          max="24"
          placeholder="14">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="rotacion">Rotación de la Fila (°):</label>
        <input 
          type="number" 
          id="rotacion"
          [ngModel]="fila.estilo?.rotation || 0" 
          (ngModelChange)="updateStyleProperty('rotation', $event)"
          class="form-control"
          min="-180"
          max="180"
          placeholder="0">
      </div>
    </div>
  </div>

  <div class="form-group">
    <label for="separacion">Separación entre asientos:</label>
    <input 
      type="number" 
      id="separacion"
      [(ngModel)]="fila.separacion" 
      (ngModelChange)="onFilaChange()"
      class="form-control"
      min="0"
      placeholder="Separación en píxeles">
  </div>

  <div class="form-group">
    <label for="curvatura">Curvatura:</label>
    <input 
      type="number" 
      id="curvatura"
      [(ngModel)]="fila.curvatura" 
      (ngModelChange)="onFilaChange()"
      class="form-control"
      placeholder="Curvatura (positiva hacia abajo, negativa hacia arriba)">
  </div>

  <!-- Gestión de Asientos -->
  <div class="asientos-section">
    <h4>Asientos</h4>
    
    <div class="asientos-header">
      <div class="asientos-info">
        <span class="asientos-count">
          Total: {{fila.asientos?.length || 0}} asientos
        </span>
      </div>
      
      <div class="asientos-acciones">
        <button 
          type="button" 
          class="btn btn-primary btn-sm"
          (click)="abrirSelectorTickets()"
          [disabled]="!evento">
          <i class="fas fa-plus"></i>
          Agregar desde Tickets
        </button>
        
        <button 
          type="button" 
          class="btn btn-outline-danger btn-sm"
          (click)="eliminarTodosAsientos()"
          [disabled]="!fila.asientos || fila.asientos.length === 0">
          <i class="fas fa-trash"></i>
          Eliminar Todos
        </button>
      </div>
    </div>

    <!-- Lista de asientos -->
    <div class="asientos-lista" *ngIf="fila.asientos && fila.asientos.length > 0">
      <div 
        *ngFor="let asiento of fila.asientos; let i = index"
        class="asiento-item">
        <div class="asiento-info">
          <div class="asiento-visual" 
               [style.background-color]="getEstilosAsiento(asiento, fila).backgroundColor"
               [style.border]="'1px solid ' + (getEstilosAsiento(asiento, fila).borderColor)"
               [style.width.px]="getEstilosAsiento(asiento, fila).width"
               [style.height.px]="getEstilosAsiento(asiento, fila).height">
            {{asiento.ticket?.numero || 'A' + (i + 1)}}
          </div>
          <div class="asiento-detalles">
            <div class="asiento-ticket">
              <strong>{{asiento.ticket?.numero || 'Sin ticket'}}</strong>
            </div>
            <div class="asiento-estado" *ngIf="asiento.ticket">
              Estado: {{obtenerNombreEstado(asiento.ticket.estado)}}
            </div>
            <div class="asiento-margenes">
              Márgenes: L{{asiento.margenL}} - R{{asiento.margenR}}
            </div>
          </div>
        </div>
        <div class="asiento-controles">
          <div class="margen-controles">
            <label>Margen Izq:</label>
            <input 
              type="number" 
              [(ngModel)]="asiento.margenL"
              (ngModelChange)="onFilaChange()"
              class="form-control-sm"
              min="0"
              max="50">
            <label>Margen Der:</label>
            <input 
              type="number" 
              [(ngModel)]="asiento.margenR"
              (ngModelChange)="onFilaChange()"
              class="form-control-sm"
              min="0"
              max="50">
          </div>
          <button 
            type="button" 
            class="btn btn-outline-danger btn-xs"
            (click)="eliminarAsiento(i)"
            title="Eliminar asiento">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Mensaje cuando no hay asientos -->
    <div class="no-asientos" *ngIf="!fila.asientos || fila.asientos.length === 0">
      <p class="text-muted">
        <i class="fas fa-info-circle"></i>
        No hay asientos en esta fila. 
        <span *ngIf="evento">Haga clic en "Agregar desde Tickets" para comenzar.</span>
        <span *ngIf="!evento">Seleccione un evento primero.</span>
      </p>
    </div>
  </div>

  <!-- Selector de Tickets Modal -->
  <app-selector-tickets
    [visible]="mostrarSelectorTickets"
    [evento]="evento"
    (ticketsSeleccionados)="onTicketsSeleccionados($event)"
    (cerrar)="cerrarSelectorTickets()">
  </app-selector-tickets>
</div>
